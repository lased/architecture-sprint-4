# Планирование: анализ, идентификация проблем и поиск решений

## Анализ проблемных мест

### Архитектурные

- Проблемы с маштабированием: по 1 инстансу в каждом приложении, а также на самой БД, как следствие - отсутствие возможности горизонтального масштабирования
- Проблема с обработкой анализа стоимости, исходя из предыдущего пункта можно сделать вывод, что подсчет выполняет последовательно и из за чего могут возникать проблемы со временем обработки заказа, тут также, исходя из схемы, видно, что, чтобы пользователь смог рассчитать стоимость, он должен пройти через продажника, что может накладывать некоторую ненужную работу на них
- Проблема с потерей заказов, может случиться ситуация, в которой заказ может не дойти до обработки, нет систем отслеживания потерянных заказов
- Проблема производительности MES API, так как он выполняет как функцию API, так и функцию консюмера - это может привести к проблемам спрогрузкой данных на дашборд MES
- Возможно неоптимальная работа с данными в БД MES
- Отсутствие мониторингов - здесь можно было бы просматривать среднее время нахождения заказа в том или ином состоянии, аналогично и с расчетом через MES
- Отсутствие трейсинга, которое помогло бы выявить проблемные места в нынешной архитектуре взаимодействия между микросервисами

### Процессные

- Долгий TTM из за ручного тестирования и как следствие блокировка всего релиза из за критичных багов
- Деплой в дев среду после мержа
- Распределение заказов между операторами, как следствие возникает ситуация, при которой оператор может доминировать над другими, за счет своей скорости обработки заказов

## Необходимые инициативы

### Архитектурные

- Добавление возможности горизонтального масштабирования для инстансов приложения, а также возможности автоматического скаллирования инстансов
- Добавить БД реплик, если данных в БД много разбить на шарды, так мы снизим нагрузку на 2 инстанс БД и распараллелим нагрузку на чтение из БД
- Добавить кэширование на часто запрашиваемые данные системы, что позволит нам ускорить ответ от сервера
- Добавить возможность отправки анализа стоимости изделия пользователя на сайте напрямую в очередь RebbitMQ, дабы снизить нагрузку на продажников
- Оптимизация очереди RebbitMQ за счет распараллеливания потоков в нем
- Добавить возможность отслеживать потерянные заказы
- Оптимизация БД MES, если таковая требуется
- Добавить систему мониторинга, трейсинга и логирования
- Добавить систему алертов на критически важные элементы системы

### Процессные

- Улучшения процесса тестирования, за счет прогона автотестов на релиз
- Добавление возможности выкатки в dev окружение под веткой без мержа
- Добавить возможность управления тестовыми фичами через feature toggles
- Оптимальное распределение между операторами

## Целевая архитектура через полгода

- Полная наблюдаемость за процессами системы - мониторинги, трейсы и логирование
- Алертинг на критически важные алементы системы
- Возможность горизонтального масштабирования, а также возможность автоскаллирования
- Оптимизированные схемы БД MES
- БД MES поделена на реплики (возможно не только она, если есть проблемы с клиентской БД, то ее также нужно оптимизировать и поделить на реплики)
- Возможность поиска и определения потерянных заказов
- Улучшение производительности при подсчете стоимости заказа

### Топ-3 инициативы на полгода

- Полная наблюдаемость за процессами системы - мониторинги, трейсы и логирование. Позволит нам наблюдать за состоянием систем, проще дебажить ошибки, а также находить по трейсам места, где возникли ошибки. На основе построенной системе можно будет легко настроить систему алертига на основе метрик от приложений
- Горизонтальное масштабирование - позволит нам оптимизировать нагрузку на приложения и снизить время отклика от системы, что позволит справится с линейно растущей нагрузкой на систему. В нее также включаем репликацию БД
- Улучшения механизмов работы с заказами - заказы являются важнейшей частью нашего приложения, поэтому потеря заказов могут повлечь за собой большие проблемы, особенно со стороны B2B сегмента
