# Архитектурное решение по логированию

## Мотивация

Внедрение системы логирования позволит сократить время на поиску и устранение ошибки в системе, а также позволит проанализировать поведение пользователей, у которых выявились те или иные проблемы при работе с системой
## Предлагаемое решение

На [схеме](jewerly_c4_model.drawio) добавлена новая система логирования ELK и сбора метрик Prometheus. Технологический стек будет следующим:
- Filebeat для получения и отправки логов в систему логирования
- Logstash для обработки логов
- Elasticsearch для хранения
- Kibana для визуализации
### Уровни логирования
#### Debug

- Соединения с БД
- Соединения с RabbitMQ
- Живучесть приложения (ping/pong логи)
#### Info

- Процесс обработки 3D-модели
- Процесс расчета стоимости
- Запросы и ответы от API приложений
#### Warn

- Попытки ретраев и повторных операций
- Ошибки запроса
- Таймауты запросов

#### Error

- Ошибки связанные с запросами/ответами
- Ошибки при работе с БД/S3
- Проблемы с очередью RabbitMQ
- Рестарт приложений (OOM, например)


### Политика безопасности

- Логи будем дополнительно обрабатывать маскированием персональных данных, если таковые будут
- Политика ACL для доступа к логам - админский доступ, для команды поддержки и для разработчиков
### Политика хранения

- Хранить логи будем 3 месяца в HOT хранилище
- Хранить логи будем 6 месяцев в COLD хранилище
### Алерты

Для системы алертинга будем использовать настроенный Aleertmanager на прошлом этапе и на следующие типы ошибок:

- Рестарты приложений (OOM)
- Резкое увеличение RPS
- Резкое увеличение кол-ва используемых ресурсов
- Резкое увеличение заказов, что может быть также подозрительно
- Статус ответов отличных от 200-ых
- Проблемы с очередями

