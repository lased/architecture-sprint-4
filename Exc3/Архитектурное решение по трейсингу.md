# Архитектурное решение по трейсингу

## Мотивация

Внедрение трейсинга позволит определить места потери заказов, например, на данный момент можно предположить, что проблемы могут быть в местах:

- Internet Shop -> Shop API
- Shop API -> Shop DB
- Shop API -> S3
- CRM API -> RabbitMQ
- RabbitMQ -> MES API
- MES API -> MES DB
  И для того, чтобы разобраться в чем именно может быть проблема и нужно внедрить систему трейсинга, также данная система позволит быстро дебажить проблемные места в системе.

## Предлагаемое решение

На [схеме](jewerly_c4_model.drawio) добавлена система сбора трейсов OpenTelemetry. Под капотом будем использовать связку Jueger + ElasticSearch для быстрого поиска в режиме реального времени.
Также нам потребуется в каждый сервис добавить агентов для отправки данных по трейингам:

- Trace ID (уникальный идентификатор цепочки событий)
- Span ID (идентификатор конкретной операции)
- Parent Span ID (идентификатор родительской операции)
- Timestamp (время события)
- Service name (имя сервиса)
- Operation name (название операции)
- Duration (длительность операции)

## Компромиссы

- Потребуется также дорабоатть существующие системы для отдачи трейсинга в систему OpenTelemetry
- Потребуется время на дообучение персонала по работе с трейсом
- Увеличение сетевого трафика
- Затраты на производстенные ресурсы (потребуется поднимать систему трейсинга)

Для обеспечения безопасности будет внедрен доступ только авторизованным пользователям, также нужно будет настроить время хранения данных по трейсам (примерно 3 месяца)
